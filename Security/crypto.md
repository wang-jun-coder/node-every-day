## 加密


### 加密算法分类
* 对称加密
	* 加密解密使用同样的秘钥
* 非对称加密（公开密钥加密）
	* 公钥加密的数据只能用私钥解密
	* 私钥加密的数据只能用公钥解密

### HTTPS、TLS、SSL
HTTPS 也称作 HTTP over SSL，相当于 HTTP + SSL/TLS。
TLS 的前身是 SSL，TLS 1.0 常被标识为 SSL 3.1， TLS1.1 为 SSL 3.2，TLS 1.2为SSL 3.3

#### SSL/TLS 的运行过程
其基本思路是采用公钥加密算法，客户端向服务器所有公钥，使用公钥加密后传输信息，服务器使用私钥解密。  
为了防止公钥被篡改，采用数字证书（包含公钥等信息，客户端通过数字签名进行验证），只要证书是可信的，公钥就是可信的，浏览器内置CA根证书。  
非对称加密计算量较大，所以在每一次会话时客户端和服务器均生成一个 会话秘钥 ，使用会话秘钥进行对称加密，对会话秘钥进行非对称加密，以减少加密所消耗的时间。

主要流程分四个步骤，这四个步骤通信都是明文的

* 客户端先向服务器发起请求，并提供信息
	* 支持的协议版本，如：TLS 1.2
	* 客户端随机数，用于生成会话秘钥
	* 支持的加密算法
	* 支持的压缩算法
* 服务器回应请求，并返回以下内容
	* 确认使用的协议，若无法与浏览器所支持的达成一致则关闭加密通信
	* 服务器随机数，用于生产会话秘钥
	* 确认加密使用算法
	* 服务器的数字证书
* 客户端收到回应，验证证书（证书机构，域名，时效等）, 通过后再向服务器发送以下信息
	* 一个随机数，使用服务器公钥加密
	* 编码改变通知，标记随后信息均使用加密方法和秘钥传送
	* 客户端握手结束通知，同时也是前面发送内容的 hash 值，用来供服务器校验

* 服务器最后回应
	* 编码改变通知，标记随后使用约定的加密方法和秘钥发送
	* 服务器握手结束通知，同时也是前面发送内容的 hash 值，供客户端校验

上述过程出现了三个随机数，前两个明文发送，第三个则通过公钥加密发送，此时客户端和服务端均知道这三个随机数，两端分别使用事先约定的加密算法生成同一把 会话秘钥，之后的传输，使用这个会话秘钥进行对称加密。

#### 数字证书如何确保不被篡改
* 客户端不可能内置所有公钥，但可内置 CA 公钥证书（数量不多）
* 若服务端给客户端仅传递公钥，中途可能被中间人替换公钥，无法确保信息不泄露
* 服务端可以通过 CA 认证拿到 数字证书（包含公钥和数字签名等），传递给客户端（传输过程也可能被替换，但浏览器无法解密，除非客户端信任被替换的证书）
* 客户端接收到服务器的数字证书后，通过 CA 解密拿到公钥和数字签名，同时客户端通过相同算法（域名，证书，等信息）自己生成数字签名，与数字证书内的签名进行对比。


### https通信如何劫持？
* 客户端信任中间人证书
* 中间人自己签发数字证书，由于客户端已信任中间人证书，则与中间人建立 https 连接，
* 中间人与真实服务器链接，并转发响应信息给客户端
* 重要的是，不要轻易信任证书







